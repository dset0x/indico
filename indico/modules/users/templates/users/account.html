{% extends 'users/base.html' %}
{% from 'forms/form_widget.html' import form_header, form_rows, form_footer  %}
{% from 'switch.html' import switch %}

{% block subtitle -%}
    {% trans %}Account details{% endtrans %}
{%- endblock %}

{% block user_content %}
    <div class="i-box-group vert">
        <div class="i-box titled">
            <div class="i-box-header">
                <div class="i-box-title">
                    {%- trans %}Details{% endtrans -%}
                </div>
            </div>
            <div class="i-box-content">
                {{ form_header() }}
                {{ form_rows(form) }}
                {% call form_footer() %}
                    <input class="i-button big highlight" type="submit" value="{% trans %}Save{% endtrans %}">
                {% endcall %}
            </div>
        </div>
        <div class="i-box titled">
            <div class="i-box-header">
                <div class="i-box-title">
                    {%- trans %}Preferences{% endtrans -%}
                </div>
            </div>
            <div class="i-box-content">
                <form class="i-form horizontal">
                    <div class="form-group">
                        <div class="form-label form-block form-label-middle">
                            <label for="currencies">{% trans %}Language{% endtrans %}</label>
                        </div>
                        <div class="form-field form-block">
                            <div id="selectLanguage"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label form-block form-label-middle">
                            <label for="currencies">{% trans %}My Timezone{% endtrans %}</label>
                        </div>
                        <div class="form-field form-block">
                            <div id="myTimezone"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label form-block form-label-middle">
                            <label for="currencies">{% trans %}Display Timezone{% endtrans %}</label>
                        </div>
                        <div class="form-field form-block">
                            <div id="displayTimezone"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label form-block">
                            <label for="currencies">{% trans %}Show past events by default{% endtrans %}</label>
                        </div>
                        <div class="form-field form-block">
                            {{ switch(value=show_past_events) }}
                        </div>
                    </div>
                    <div class="form-group form-group-footer">
                        <div class="form-label form-block"></div>
                        <div class="form-field form-block">
                            <input class="i-button big highlight" type="submit" value="{% trans %}Save preferences{% endtrans %}">
                        </div>
                    </div>
                </form>
                <script type="text/javascript">
                    var langCallback = function(){
                        $E("selectLanguage").set(languageSelector.draw());
                    };
                    var languageSelector = new SelectRemoteWidget("user.getLanguages",{"userId": "{{ user.getId() }}"},langCallback, null, null, "{{ user.getLang() }}");

                    var tzCallback = function(){
                        $E("myTimezone").set(myTimezoneSelector.draw());
                    };
                    var myTimezoneSelector = new SelectRemoteWidget("user.getTimezones",{"userId": "{{ user.getId() }}"},tzCallback, null, null, "{{ user.getTimezone() }}");

                    var displayTzCallback = function(){
                        $E("displayTimezone").set(displayTimezoneSelector.draw());
                    };
                    var displayTimezoneSelector = new SelectRemoteWidget("user.getDisplayTimezones",{"userId": "{{ user.getId() }}"},displayTzCallback, null, null, "{{ display_timezones }}");
                </script>
            </div>
        </div>
    </div>
{% endblock %}
